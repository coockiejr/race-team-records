var app=angular.module("mcrrcApp",["restangular","ui.bootstrap","ui.router","appRoutes","MainCtrl","TeamCtrl","LoginCtrl","SignUpCtrl","RecCtrl","ProfileCtrl","AuthService"]);app.run(["$http","AuthService","Restangular",function($http,AuthService,Restangular){Restangular.setBaseUrl("/api/"),Restangular.setRestangularFields({id:"_id"}),$http.get("/api/login").success(function(data){AuthService.setUser(data.user)}).error(function(data){$scope.message=data[0],$state.go("/login")})}]),angular.module("LoginCtrl",[]).controller("LoginController",["$scope","$http","$state","AuthService",function($scope,$http,$state,AuthService){$http({url:"/api/login",method:"GET"}).success(function(data){$scope.message=data.message}),$scope.login=function(user){$http.post("/api/login",user).success(function(data){AuthService.setUser(data.user),window.location.href="/"}).error(function(data){$scope.message=data[0],$state.go("/login")})}}]),angular.module("MainCtrl",[]).controller("MainController",["$scope","$modal","AuthService","Restangular",function($scope,$modal,AuthService,Restangular){$scope.user=AuthService.isLoggedIn();var results=Restangular.all("results");$scope.resultsList=[],Restangular.all("results").getList().then(function(results){$scope.resultsList=results}),$scope.showAddResultModal=function(){var modalInstance=$modal.open({templateUrl:"resultModal.html",controller:"ResultModalInstanceCtrl",size:"lg",resolve:{result:!1}});modalInstance.result.then(function(result){$scope.createResult(result)},function(){})},$scope.createResult=function(result){results.post(result).then(function(results){$scope.resultsList=results},function(res){console.log("Error: "+res.status)})}}]),angular.module("MainCtrl").controller("ResultModalInstanceCtrl",["$scope","$modalInstance","result","Restangular",function($scope,$modalInstance,result,Restangular){Restangular.all("members").getList().then(function(members){$scope.membersList=members}),$scope.editmode=!1,result?($scope.formData=result,$scope.editmode=!0):($scope.formData={},$scope.editmode=!1),$scope.today=function(){$scope.formData.racedate=new Date},$scope.today(),$scope.addResult=function(){$scope.formData.time=3600*$scope.time.hours+60*$scope.time.minutes+$scope.time.seconds,console.log($scope.formData),$modalInstance.close($scope.formData)},$scope.editResult=function(){$modalInstance.close($scope.formData)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("ProfileCtrl",[]).controller("ProfileController",function($scope,$http){$http({url:"/api/profile",method:"GET"}).success(function(data){$scope.user=data.user})}),angular.module("RecCtrl",[]).controller("RecordController",["$scope","AuthService",function(){}]),angular.module("SignUpCtrl",[]).controller("SignUpController",function($scope,$http,$state){$scope.signup=function(user){$http.post("/api/signup",user).success(function(){window.location.href="/"}).error(function(data){$scope.message=data[0],$state.go("/signup")})}}),angular.module("TeamCtrl",[]).controller("TeamController",["$scope","$http","$modal","Restangular","AuthService",function($scope,$http,$modal,Restangular,AuthService){$scope.user=AuthService.isLoggedIn();var members=Restangular.all("members");$scope.membersList=[],$scope.adminDivisCollapsed=!0,$scope.adminEditMode=!1,$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.retrieveMemberForEdit=function(member){if(member){var modalInstance=$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:"lg",resolve:{member:function(){return member}}});modalInstance.result.then(function(member){$scope.editMember(member)},function(){})}},$scope.showAddMemberModal=function(){var modalInstance=$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:"lg",resolve:{member:!1}});modalInstance.result.then(function(member){$scope.createMember(member)},function(){})},$scope.setMember=function(member){$scope.currentMember=member},Restangular.all("members").getList().then(function(members){$scope.membersList=members}),$scope.getMember=function(id){return Restangular.one("members",id).get().then(function(member){return member},function(res){console.log("Error: "+res.status)})},$scope.createMember=function(member){members.post(member).then(function(members){$scope.membersList=members},function(res){console.log("Error: "+res.status)})},$scope.editMember=function(member){member.save()},$scope.deleteMember=function(member){member.remove().then(function(){var index=$scope.membersList.indexOf(member);index>-1&&$scope.membersList.splice(index,1)},function(res){console.log("Error: "+res.status)})}}]),angular.module("TeamCtrl").controller("ModalInstanceCtrl",["$scope","$modalInstance","member",function($scope,$modalInstance,member){$scope.editmode=!1,member?($scope.formData=member,$scope.editmode=!0):($scope.formData={},$scope.editmode=!1),$scope.today=function(){$scope.formData.dateofbirth=new Date},$scope.today(),$scope.addMember=function(){$modalInstance.close($scope.formData)},$scope.editMember=function(){$modalInstance.close($scope.formData)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]);var app=angular.module("mcrrcApp");app.directive("onlyDigitsForMinSec",function(){return{require:"ngModel",restrict:"A",link:function(scope,element,attr,ctrl){function inputValue(val){if(val){var digits=val.replace(/[^0-9]/g,"");return 0>digits&&(digits="0"),digits>59&&(digits="59"),digits!==val&&(ctrl.$setViewValue(digits),ctrl.$render()),parseInt(digits,10)}return void 0}ctrl.$parsers.push(inputValue)}}}),app.directive("onlyDigits",function(){return{require:"ngModel",restrict:"A",link:function(scope,element,attr,ctrl){function inputValue(val){if(val){var digits=val.replace(/[^0-9]/g,"");return digits!==val&&(ctrl.$setViewValue(digits),ctrl.$render()),parseInt(digits,10)}return void 0}ctrl.$parsers.push(inputValue)}}});var app=angular.module("mcrrcApp");app.filter("secondsToTimeStringLong",function(){return function(sec){var hours=Math.floor(sec%86400/3600),minutes=Math.floor(sec%86400%3600/60),seconds=Math.floor(sec%86400%3600%60),timeString="";return hours>0&&(timeString+=hours>1?hours+" hours ":hours+" hour "),minutes>0&&(timeString+=minutes>1?minutes+" minutes ":minutes+" minute "),seconds>=0&&(timeString+=seconds>1?seconds+" seconds ":seconds+" second "),timeString}}),app.filter("secondsToTimeString",function(){return function(sec){var hours=Math.floor(sec%86400/3600),minutes=Math.floor(sec%86400%3600/60),seconds=Math.floor(sec%86400%3600%60);return 10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),hours+":"+minutes+":"+seconds}}),angular.module("appRoutes",[]).config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("/",{url:"/",controller:"MainController",templateUrl:"views/home.html"}).state("/team",{url:"/team",templateUrl:"views/team.html",controller:"TeamController"}).state("/login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController"}).state("/signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignUpController"}).state("/profile",{url:"/profile",templateUrl:"views/profile.html",controller:"ProfileController"}).state("/records",{url:"/records",templateUrl:"views/records.html",controller:"RecordController"})}),angular.module("AuthService",[]).factory("AuthService",[function(){var user;return{setUser:function(aUser){user=aUser},isLoggedIn:function(){return user?user:!1}}}]),angular.module("MemberService",[]).factory("Member",function(){}),angular.module("NerdService",[]).factory("Nerd",["$http",function(){}]);